<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>axios中的拦截器</title>
    <script src="./js/axios.min.js"></script>
</head>

<body>
    <!-- 
        axios请求拦截器
            1.是什么？
                在真正发请求前执行的一个回调函数
            2.作用
                对所有的请求做统一的处理：追加请求头，追加参数，界面loading提示等等

        axios响应拦截器
            1.是什么？
                得到响应之后执行的一组回调函数
            2.作用
                若请求成功，对成功的数据进行处理
                若请求失败，对失败进行统一的操作
    -->
    <button id="btn">点我获取所有人</button>
    <script>
        const btn = document.getElementById('btn')

        // 请求拦截器
        axios.interceptors.request.use((config) => {
            console.log('请求拦截器执行了')
            if (Date.now() % 2 === 0) {
                config.headers.token = 'atguigu'
            }
            return config
        })

        // 响应拦截器
        axios.interceptors.response.use(
            response => {
                console.log('响应拦截器成功的回调执行了', response)
                if (Date.now() % 2 === 0) {
                    return response.data
                } else {
                    return '时间戳不是偶数，不能给你数据'
                }
            },
            error => {
                console.log('响应拦截器失败的回调执行了')
                alert(error)
                return new Promise(() => { })
            }
        )

        btn.onclick = async () => {
            const result = await axios.get('http://localhost:5000/persons')
            console.log(result)
        }
    </script>
</body>

</html>